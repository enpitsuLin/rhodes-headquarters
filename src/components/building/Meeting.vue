<script setup lang="ts">
import Base from './Base.vue'
import ResidentCharacter from './ResidentCharacter.vue'
import type { BuildingMeeting } from '~/types'

const props = defineProps<{ data: BuildingMeeting }>()

const clueBoardList = [
  'RHINE',
  'PENGUIN',
  'BLACKSTEEL',
  'URSUS',
  'GLASGOW',
  'KJERAG',
  'RHODES',
] as const

function inClueBoard(index: number) {
  if (!props.data.clue.board.at(index - 1))
    return false

  return clueBoardList.includes(props.data.clue.board.at(index - 1) as typeof clueBoardList[number])
}
</script>

<template>
  <Base title="会客室" :level="data.level" color="white">
    <template #icon>
      <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_502_927)">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M29.6943 -2.28332C28.0271 -3.23889 25.9729 -3.23889 24.3057 -2.28332L-3.3057 13.542C-4.97294 14.4976 -6 16.2635 -6 18.1747V49.8253C-6 51.7365 -4.97294 53.5024 -3.3057 54.458L24.3057 70.2833C25.9729 71.2389 28.0271 71.2389 29.6943 70.2833L57.3057 54.458C58.9729 53.5024 60 51.7365 60 49.8253V18.1747C60 16.2635 58.9729 14.4976 57.3057 13.542L29.6943 -2.28332ZM55.0378 16.4452L27.9622 0.927022C27.3668 0.585747 26.6332 0.585746 26.0378 0.927021L-1.03775 16.4452C-1.63319 16.7865 -2 17.4172 -2 18.0997V49.1361C-2 49.8186 -1.63319 50.4493 -1.03775 50.7906L26.0378 66.3088C26.6332 66.6501 27.3668 66.6501 27.9622 66.3088L55.0378 50.7906C55.6332 50.4493 56 49.8186 56 49.1361V18.0997C56 17.4172 55.6332 16.7865 55.0378 16.4452Z" fill="#44464B" />
          <rect x="6" y="47" width="8" height="3" rx="1.5" fill="#44464B" />
          <rect x="39" y="47" width="8" height="3" rx="1.5" fill="#44464B" />
          <path d="M2 31C2 29.3431 3.34531 28 5.00217 28C6.86645 28 7.64591 28 8.99944 28C10.6563 28 12 29.3431 12 31V33C12 34.6569 13.3431 36 15 36H38C39.6569 36 41 34.6569 41 33V31C41 29.3431 42.3424 28 43.9993 28C45.2504 28 46.71 28 48.0014 28C49.6582 28 51 29.3431 51 31V43C51 44.6569 49.6569 46 48 46H5C3.34314 46 2 44.6569 2 43V31Z" fill="#44464B" />
          <path d="M39 34H14V31.5C14 28.7386 11.7614 26.5 9 26.5H6C6 23.1863 8.68629 20.5 12 20.5H41C44.3137 20.5 47 23.1863 47 26.5H44C41.2386 26.5 39 28.7386 39 31.5V34Z" fill="#44464B" />
        </g>
        <defs>
          <clipPath id="clip0_502_927">
            <rect width="60" height="60" fill="white" />
          </clipPath>
        </defs>
      </svg>
    </template>
    <template #extra>
      <div h-full flex="~ col justify-center gap-4px" px-4px>
        <div flex="~ col gap-2px">
          <div flex="~ items-center justify-between gap-4px">
            <div class="text-#fd661c">
              {{ data.clue.sharing ? '交流中' : '搜集中' }}
            </div>

            <div flex="~ items-center gap-4px">
              <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_516_902)">
                  <path d="M14.1702 3.84884H11.2199V0.872093L14.1702 3.84884Z" fill="#FD661C" />
                  <path d="M10.3901 4.59302H14.4468V8.59302H2.64539V0.5H10.3901V4.59302Z" fill="#FD661C" />
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M14.9078 12.593H2V9.24419H15L14.9078 12.593ZM3.26354 10.7326H3.42594C3.41372 10.663 3.39145 10.6011 3.35915 10.5469C3.32684 10.4923 3.28668 10.446 3.23866 10.4082C3.19064 10.3699 3.13673 10.3408 3.07692 10.321C3.01755 10.3011 2.95403 10.2912 2.88637 10.2912C2.77199 10.2912 2.67028 10.3194 2.58122 10.3758C2.49217 10.4322 2.4221 10.5123 2.37103 10.6163C2.31995 10.7202 2.29441 10.8436 2.29441 10.9863C2.29441 11.129 2.31995 11.2523 2.37103 11.3562C2.4221 11.4602 2.49217 11.5403 2.58122 11.5967C2.67028 11.6531 2.77199 11.6813 2.88637 11.6813C2.95403 11.6813 3.01755 11.6714 3.07692 11.6516C3.13673 11.6317 3.19064 11.6029 3.23866 11.565C3.28668 11.5267 3.32684 11.4802 3.35915 11.4256C3.39145 11.371 3.41372 11.3091 3.42594 11.24H3.26354C3.25394 11.2867 3.23713 11.3281 3.21312 11.3642C3.18955 11.3998 3.16074 11.43 3.12669 11.4547C3.09307 11.4789 3.05575 11.4972 3.01471 11.5095C2.97368 11.5219 2.9309 11.528 2.88637 11.528C2.80517 11.528 2.73161 11.5073 2.66569 11.4659C2.60021 11.4245 2.54805 11.3635 2.50919 11.2829C2.47078 11.2023 2.45157 11.1034 2.45157 10.9863C2.45157 10.8691 2.47078 10.7702 2.50919 10.6896C2.54805 10.609 2.60021 10.548 2.66569 10.5066C2.73161 10.4652 2.80517 10.4445 2.88637 10.4445C2.9309 10.4445 2.97368 10.4507 3.01471 10.463C3.05575 10.4753 3.09307 10.4938 3.12669 10.5185C3.16074 10.5427 3.18955 10.5727 3.21312 10.6084C3.23713 10.644 3.25394 10.6854 3.26354 10.7326ZM4.65107 11.3562C4.70215 11.2523 4.72769 11.129 4.72769 10.9863C4.72769 10.8436 4.70215 10.7202 4.65107 10.6163C4.6 10.5123 4.52993 10.4322 4.44088 10.3758C4.35182 10.3194 4.25011 10.2912 4.13573 10.2912C4.02136 10.2912 3.91964 10.3194 3.83059 10.3758C3.74153 10.4322 3.67146 10.5123 3.62039 10.6163C3.56931 10.7202 3.54377 10.8436 3.54377 10.9863C3.54377 11.129 3.56931 11.2523 3.62039 11.3562C3.67146 11.4602 3.74153 11.5403 3.83059 11.5967C3.91964 11.6531 4.02136 11.6813 4.13573 11.6813C4.25011 11.6813 4.35182 11.6531 4.44088 11.5967C4.52993 11.5403 4.6 11.4602 4.65107 11.3562ZM5.97198 11.6628V10.3097H5.8122V11.3747H5.7991L5.06571 10.3097H4.90855V11.6628H5.07094V10.6004H5.08404L5.81482 11.6628H5.97198ZM6.20473 10.3097V11.6628H6.36713V11.0576H6.94861V10.9123H6.36713V10.4551H7.00885V10.3097H6.20473ZM7.35718 11.6628V10.3097H7.19479V11.6628H7.35718ZM7.59059 11.6628H8.00444C8.14064 11.6628 8.25632 11.6357 8.35149 11.5815C8.44666 11.5269 8.51913 11.449 8.56889 11.3477C8.61866 11.2459 8.64354 11.1246 8.64354 10.9836C8.64354 10.8436 8.61888 10.7233 8.56955 10.6229C8.52022 10.522 8.44928 10.4447 8.35673 10.391C8.26418 10.3368 8.15286 10.3097 8.02277 10.3097H7.59059V11.6628ZM8.82375 10.3097V11.6628H9.64358V11.5174H8.98614V11.0576H9.5912V10.9123H8.98614V10.4551H9.6331V10.3097H8.82375ZM10.897 11.6628V10.3097H10.7373V11.3747H10.7242L9.99077 10.3097H9.83361V11.6628H9.99601V10.6004H10.0091L10.7399 11.6628H10.897ZM11.0565 10.3097V10.4551H11.4782V11.6628H11.6406V10.4551H12.0623V10.3097H11.0565ZM12.3831 11.6628V10.3097H12.2207V11.6628H12.3831ZM12.6715 11.6628H12.5012L12.9937 10.3097H13.1613L13.6537 11.6628H13.4835L13.3487 11.2796H12.8063L12.6715 11.6628ZM13.7704 10.3097V11.6628H14.5562V11.5174H13.9328V10.3097H13.7704Z" fill="#FD661C" />
                  <path d="M13.0827 10.5238H13.0722L12.8575 11.1343H13.2975L13.0827 10.5238Z" fill="#FD661C" />
                  <path d="M14.4468 13.2442V16.5H2.64539V13.2442H14.4468Z" fill="#FD661C" />
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M4.57053 10.9863C4.57053 10.8691 4.55111 10.7702 4.51225 10.6896C4.47384 10.609 4.42167 10.548 4.35575 10.5066C4.29027 10.4652 4.21693 10.4445 4.13573 10.4445C4.05453 10.4445 3.98098 10.4652 3.91506 10.5066C3.84958 10.548 3.79741 10.609 3.75856 10.6896C3.72014 10.7702 3.70093 10.8691 3.70093 10.9863C3.70093 11.1034 3.72014 11.2023 3.75856 11.2829C3.79741 11.3635 3.84958 11.4245 3.91506 11.4659C3.98098 11.5073 4.05453 11.528 4.13573 11.528C4.21693 11.528 4.29027 11.5073 4.35575 11.4659C4.42167 11.4245 4.47384 11.3635 4.51225 11.2829C4.55111 11.2023 4.57053 11.1034 4.57053 10.9863ZM7.99396 11.5174H7.75299V10.4551H8.0123C8.11707 10.4551 8.20459 10.4764 8.27488 10.5192C8.34516 10.5614 8.39798 10.6222 8.43334 10.7015C8.4687 10.7804 8.48638 10.8744 8.48638 10.9836C8.48638 11.0937 8.46849 11.1887 8.43269 11.2684C8.39689 11.3481 8.34254 11.4095 8.26964 11.4527C8.19674 11.4959 8.10484 11.5174 7.99396 11.5174Z" fill="#FD661C" />
                </g>
                <defs>
                  <clipPath id="clip0_516_902">
                    <rect width="16" height="16" fill="white" transform="translate(0 0.5)" />
                  </clipPath>
                </defs>
              </svg>

              <span>
                <span class="text-#fd661c">6</span>/10
              </span>
            </div>
          </div>
          <div class="bg-border" h-3px w-full>
            <div class="bg-#fd661c" h-3px :style="{ width: `${(6 / 10) * 100}%` }" />
          </div>
        </div>
        <div flex="~ items-center gap-4px">
          <div
            v-for="i in 7" :key="i"
            border="~ border"
            bg="[&.include]:border"
            h-16px w-12px text-center text-12px
            flex="inline items-center justify-center"
            :class="inClueBoard(i) && 'include'"
          >
            {{ i }}
          </div>
        </div>
      </div>
    </template>
    <ResidentCharacter
      v-for="i in data.chars"
      :key="i.charId"
      :resident="i"
    />
  </Base>
</template>
