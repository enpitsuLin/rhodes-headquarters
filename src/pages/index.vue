<script setup lang="ts">
import { useRouter } from 'vue-router/auto'
import { useMagicKeys } from '@vueuse/core'
import { useAccounts, useCurrentAccount } from '@/composables/account'
import LayoutDefault from '~/components/layouts/default.vue'
import SectionTitle from '@/components/home/SectionTitle.vue'

const router = useRouter()
const accounts = useAccounts()
const currentAccount = useCurrentAccount()

const { meta, control } = useMagicKeys()

function onOptionClick() {
  // TODO 确定一下 PC 上 control 键，可以判断环境再判断键位
  if (meta.value || control.value)
    browser.runtime.openOptionsPage()
  else router.push('/options')
}
</script>

<template>
  <LayoutDefault>
    <template v-if="accounts.length === 0">
      <h2>TODO</h2>
      <button @click="onOptionClick">
        router
      </button>
    </template>
    <template v-else-if="currentAccount">
      <header
        relative
        flex="~ items-center gap-2"
        p="x-1 b-1" h-70px
      >
        <div size-60px>
          <img :src="`https://web.hycdn.cn/arknights/game/assets/avatar/${currentAccount.gameStatus.avatar.id}.png`">
        </div>
        <div flex-1>
          <div flex="~ items-end">
            <div grid="~ rows-1 cols-7">
              <div text-20px col-span-3>
                {{ currentAccount.gameStatus.level }}
              </div>
              <div col-span-4 justify-self-start self-center flex="~ col">
                <div text-12px leading-12px transform-origin-l scale-70>
                  Lv.
                </div>
                <div text-12px leading-12px transform-origin-l scale-70>
                  博士等级
                </div>
              </div>
            </div>
            <div>UID: {{ currentAccount.gameStatus.uid }}</div>
          </div>
          <div font-bold text-base>
            Dr. {{ currentAccount.gameStatus.name }}
          </div>
        </div>
        <div>
          switcher
        </div>
        <svg
          absolute right-0 bottom-1
          width="320" height="8" viewBox="0 0 320 8" fill="none" xmlns="http://www.w3.org/2000/svg"
        >
          <g clip-path="url(#clip0_4_11)">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M312.423 2.35389C312.546 2.46982 312.7 2.55592 312.883 2.61287C313.066 2.66914 313.319 2.72881 313.64 2.7905C313.65 2.79321 313.661 2.79525 313.672 2.7966C313.683 2.79796 313.693 2.79931 313.704 2.80203C313.72 2.80474 313.735 2.80813 313.75 2.81152C313.765 2.81559 313.78 2.81898 313.797 2.82169C314.155 2.89084 314.455 2.97287 314.695 3.06711C314.936 3.16135 315.138 3.3105 315.298 3.51525C315.458 3.72067 315.539 3.99796 315.539 4.34914V4.3566C315.539 4.69965 315.454 4.99253 315.286 5.23592C315.117 5.47999 314.873 5.66575 314.553 5.79321C314.233 5.92067 313.847 5.9844 313.394 5.9844C313.114 5.9844 312.847 5.95864 312.596 5.90711C312.344 5.85559 312.109 5.7783 311.891 5.67525C311.673 5.5722 311.469 5.44338 311.279 5.28813L311.704 4.77016C311.938 4.96609 312.195 5.11389 312.477 5.21287C312.76 5.31253 313.066 5.36203 313.394 5.36203C313.858 5.36203 314.217 5.27525 314.472 5.10304C314.728 4.93016 314.856 4.68813 314.856 4.37559V4.3722C314.856 4.16609 314.799 4.00135 314.685 3.87931C314.571 3.7566 314.426 3.66575 314.248 3.60609C314.07 3.54711 313.841 3.49152 313.559 3.43999C313.551 3.43728 313.542 3.4366 313.533 3.4366C313.524 3.4366 313.514 3.43525 313.503 3.43253L313.415 3.41287C313.013 3.34372 312.689 3.26779 312.443 3.18711C312.197 3.10576 311.988 2.9627 311.815 2.75796C311.642 2.55253 311.556 2.26575 311.556 1.89762V1.89355C311.556 1.54575 311.637 1.24813 311.799 1.00203C311.961 0.755924 312.197 0.568806 312.508 0.439314C312.818 0.310501 313.191 0.246094 313.628 0.246094C313.834 0.246094 314.038 0.268467 314.24 0.311856C314.442 0.355924 314.641 0.421009 314.838 0.507111C315.035 0.59389 315.23 0.702365 315.422 0.83389L315.021 1.35999C314.785 1.19525 314.552 1.07186 314.32 0.990501C314.089 0.909145 313.858 0.868467 313.628 0.868467C313.188 0.868467 312.847 0.956602 312.604 1.13152C312.36 1.30711 312.239 1.55321 312.239 1.8705V1.87389C312.239 2.07796 312.3 2.23728 312.423 2.35389ZM309.851 5.92677H309.16V0.93084H307.446V0.304399H311.565V0.93084H309.851V5.92677ZM306.359 3.47118H303.605V5.92677H302.914V0.304399H303.605V2.83321H306.359V0.304399H307.049V5.92677H306.359V3.47118ZM301.302 5.73898C300.997 5.90237 300.627 5.9844 300.193 5.9844C299.754 5.9844 299.381 5.90711 299.073 5.75253C298.765 5.59796 298.53 5.37287 298.369 5.07796C298.207 4.78236 298.125 4.42508 298.125 4.00474V2.34575C298.125 1.89965 298.205 1.51999 298.365 1.20745C298.523 0.894229 298.756 0.655585 299.061 0.491517C299.366 0.328128 299.735 0.246094 300.169 0.246094C300.525 0.246094 300.842 0.311179 301.121 0.441348C301.399 0.571517 301.628 0.762026 301.809 1.01152C301.99 1.26169 302.117 1.56338 302.188 1.9166H301.438C301.379 1.6922 301.289 1.50304 301.169 1.34847C301.049 1.19389 300.903 1.07728 300.733 0.999992C300.563 0.922704 300.375 0.88406 300.169 0.88406C299.883 0.88406 299.639 0.941009 299.439 1.05423C299.238 1.16813 299.086 1.33355 298.983 1.55118C298.88 1.76881 298.828 2.03389 298.828 2.34575V4.00474C298.828 4.29084 298.881 4.53355 298.987 4.73355C299.092 4.93355 299.247 5.08542 299.452 5.18982C299.658 5.29423 299.904 5.34643 300.193 5.34643C300.477 5.34643 300.718 5.29287 300.916 5.18576C301.114 5.07931 301.264 4.91728 301.365 4.70101C301.467 4.48406 301.518 4.21491 301.518 3.89287V3.61016H300.213V2.98033H302.237V3.88067C302.237 4.32677 302.157 4.70711 301.998 5.02169C301.839 5.33626 301.607 5.57559 301.302 5.73898ZM296.613 0.304399H297.304V5.92677H296.613V0.304399ZM292.045 1.51592V5.9227H291.359V0.304399H292.018L294.984 4.77898V0.304399H295.671V5.9227H295.005L292.045 1.51592ZM290.204 5.92677L288.437 3.06847L287.261 4.44542V5.92677H286.57V0.304399H287.261V3.56338L289.927 0.304399H290.798L288.923 2.49898L291.043 5.92677H290.204ZM285.21 5.92677L283.965 3.54847H282.468V5.92677H281.778V0.300331H282.135H282.468H284.094C284.432 0.300331 284.728 0.36745 284.984 0.501687C285.239 0.635246 285.437 0.825755 285.578 1.07186C285.719 1.31796 285.788 1.60203 285.788 1.92406C285.788 2.24677 285.719 2.53084 285.578 2.77694C285.437 3.02304 285.239 3.21355 284.982 3.34711C284.889 3.39592 284.789 3.43253 284.686 3.46304L286.033 5.92677H285.21ZM284.957 2.44813C285.035 2.29762 285.075 2.1227 285.078 1.92406C285.078 1.72609 285.039 1.55118 284.959 1.40067C284.881 1.24948 284.769 1.13287 284.626 1.05084C284.483 0.968128 284.317 0.926772 284.126 0.926772H282.468V2.92203H284.126C284.314 2.92203 284.48 2.88067 284.624 2.79796C284.769 2.71592 284.88 2.59931 284.957 2.44813ZM280.233 4.62304H277.687L277.213 5.92677H276.459L278.611 0.304399H279.31L281.462 5.92677H280.707L280.233 4.62304ZM278.961 1.12406L277.915 3.99728H280.005L278.961 1.12406Z" fill="#44464B" />
          </g>
          <line y1="7.5" x2="320" y2="7.5" stroke="#44464B" />
          <defs>
            <clipPath id="clip0_4_11">
              <rect width="40" height="7" fill="white" transform="translate(276.002)" />
            </clipPath>
          </defs>
        </svg>
      </header>
      <section flex="~ col">
        <SectionTitle title="理智" sub="Sanity" />
        <div relative>
          <div c-border absolute right-0 top-5px>
            <svg width="71" height="75" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="m28.506 13.617 14.343-.84-6.816 21.865 9.918-.349-15.733 24.714 5.46-21.322-9.24.388 2.068-24.456Z" fill="currentColor" />
              <path d="m31.479 47.635.349-1.272-5.667-6.498-1.366.107 6.684 7.663Z" fill="currentColor" />
              <path d="m63.18 35.215-3.949-7.779 7.858.201-3.91 7.578Zm-.727-20.775 4.594 12.097-8-.205 3.406-11.892Zm-4.32 11.098L52.7 16.963l9.036-4.013-3.604 12.588Zm-18.423 6.44 12.122-14.333 5.643 8.903-17.765 5.43Zm6.285-26.555 14.597 6.832-8.468 3.761-6.129-10.593Zm-13.209 5.863L24.71 2.723l17.006 1.285-8.93 7.278ZM19.848 13.11l-7.726.72 9.33-9.705-1.604 8.985Zm4.067 13.27-11.716-.21 7.937-11.338 3.779 11.549Zm-1.04 10.636-8.347 1.205 9.402-9.715-1.055 8.51Zm-.278 17.113-.155-.03-6.45-6.873 6.806-8.182-.2 15.085Zm-12.106-2.282 4.72-3.849 5.4 5.756-10.12-1.907Zm-1.98-7.926 5.79 3.4-5.208 4.248-.581-7.648ZM4.29 34.087l7.72 4.92-3.938 2.644-3.782-7.564Zm-.68-2.338 7.125-4.164L12.29 37.88l-8.88-5.657.2-.475Zm5.733-13.673 1.217 8.338-6.244 3.649 5.027-11.987Zm4.05 19.738-1.596-10.55 11.606.207-10.01 10.343Zm.983 8.278-5.838-3.43 4.148-2.785 1.69 6.215Zm-.668-6.643 8.324-1.201-6.52 7.837-1.804-6.636Zm-3.356-23.778.605-.63 8.228-.766L11.5 25.253l-1.334-9.142.185-.44Zm53.303-4.897-19.448-9.11L22.189 0 8.54 14.198.98 32.227l5.428 10.855.84 11.048 14.538 2.585L21.269 75l4.736-7.408 2.164-7.89-4.477 6.994.4-10.884 5.84-2.535.372-1.36-6.166 2.677.006-.174-.45-.084.205-15.392.548.628.133-1.52-.243-.279.275-.085.104-1.184-.697.218 1.114-8.987h.35l.096-1.098h-.193l.227-.396.228-2.599-1.062 1.846-3.734-11.41 5.696-.726.098-1.12-5.85.746 1.833-10.28.107-.11.154.012 8.513 9.026-.815.104 3.463-.215 9.035-7.364.976.457 6.52 11.271-6.6-1.614-.328 1.051 7.056 1.726-12.028 14.221-.447 1.436 3.119-.133 14.259-4.358-8.683 7.08-1.448 2.598L58.142 27.72l4.36 8.587-16.845 1.61-1.733 3.11 20.523-2.356 5.572-11.34-6.364-16.557Z" fill="currentColor" /></svg>
          </div>
          <div h-85px flex="~ col gap-4px" p="x-4px y-8px" relative>
            <div flex="~ justify-between items-center">
              <span leading-27px font-bold text-24px>135/135</span>
              <span>下次恢复：3 分钟 59 秒</span>
            </div>
            <div flex="~ justify-between items-center" leading-17px>
              <span>全部恢复需要:</span><span>1 小时 59 分钟</span>
            </div>
            <div flex="~ justify-between items-center" leading-17px>
              <span>预计恢复时间:</span><span>1 小时 59 分钟</span>
            </div>
          </div>
        </div>
      </section>
      <SectionTitle title="罗德岛" sub="Rhodes Island" />
    </template>
  </LayoutDefault>
</template>
